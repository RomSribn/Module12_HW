"use strict";var log=function(a){return console.log(a)},key="5c265894d43f1d1580ffa62584e53c27d612d3cfaf289",cardMarkup=document.querySelector(".cards"),deleteBtn=document.querySelector(".btn"),forSearching={input:document.querySelector("input[type=\"text\"]"),submit:document.querySelector("input[type=\"submit\"]")},source=document.querySelector(".cardTemplate").innerHTML.trim(),template=Handlebars.compile(source);(function(){console.log("obj"),Object.values(localStorage).map(function(a){cardMarkup.insertAdjacentHTML("afterbegin",template(JSON.parse(a)))})})();function isValidUrl(a){var b=/(^https?:\/\/)?[a-z0-9~_\-\.]+\.[a-z]{2,9}(\/|:|\?[!-~]*)?$/i;return b.test(a)}function fetchAPI(a){return fetch("https://api.linkpreview.net/",{method:"POST",mode:"cors",body:JSON.stringify({key:key,q:a})}).then(function(a){if(a.ok)return a.json();throw new Error("Error in fetching")}).catch(function(a){return log("\u0410\u0428\u0418\u0411\u041A\u0410",a)})}forSearching.submit.addEventListener("click",handleInputLink),cardMarkup.addEventListener("click",handleDelete);function handleInputLink(){return isValidUrl(forSearching.input.value)?void fetchAPI(forSearching.input.value).then(function(a){return a?void(Object.values(localStorage).forEach(function(b){if(JSON.parse(b).url===a.url)return alert("\u0422\u0430\u043A\u043E\u0435 \u0443\u0436\u0435 \u0435\u0441\u0442\u044C!"),void(forSearching.input.value="")}),cardMarkup.insertAdjacentHTML("afterbegin",template(a)),console.log(a),localStorage.setItem(a.url,JSON.stringify(a)),forSearching.input.value=""):(alert("\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E(("),void(forSearching.input.value=""))}):(alert("Invalid url"),void(forSearching.input.value=""))}function handleDelete(a){console.log(a.target),"btn"===a.target.className&&(localStorage.removeItem(a.target.parentElement.parentElement.firstElementChild.href),a.target.parentElement.parentElement.remove())}
